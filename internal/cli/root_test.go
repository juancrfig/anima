package cli

import (
    "bytes"
    "strings"
    "testing"
    "github.com/spf13/cobra"
    "github.com/stretchr/testify/assert"
)


func mockTodayCmd() *cobra.Command {
    return &cobra.Command {
        Use: "today",
        Short: "Open today's journal entry",
        Run: func(cmd *cobra.Command, args []string) {},
    }
}


func TestRootCmdHelpOutput(t *testing.T) {
    const expectedArt = `

                                      =%@@@@@@@@@@@@@@@*.                                   
                                 .@@@@@@@@@@@@@@@@@@@@@@@@@@=                               
                              *@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@-                           
                           :@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@#                         
                         +@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@.                      
                       -@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@                     
                     .@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@=                   
                    -@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@                  
                   *@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@                 
                  *@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@                
                 =@@@@@@@@@@@@@@@@@@@@@@@%%%%%%%%%%%%%@@@@@@@@@@@@@@@@@@@@@@@               
                .@@@@@@@@@@@@@@@@@@@@%%%%%%%%%%%%%%%%%%%%@@@@@@@@@@@@@@@@@@@@*              
                @@@@@@@@@@@@@@@@@@@%%%%%%%%%%%##%%%%%%%%%%@@@@@@@@@@@@@@@@@@@@:             
               =@@@@@@@@@@@@@@@@@@%%%%%%######        #%%%%@@@@@@@@@@@@@@@@@@@@             
               %@@@@@@@@@@@@@@@@%%%%%%%#####=           :#%%%@@@@@@@@@@@@@@@@@@.            
               @@@@@@@@@@@@@@@@@%%%%%%+   *#.                        
               @@@@@@@@@@@@@@@@@%%%%#      ##@                                 
               @@@@@@@@@@@@@@@@@%%%+        +###%:          :#@@@@@@@@@@@@@@@@@*            
               @@@@@@@@@@@@@@@@%*             =###%       @%%%%@@@@@@@@@@@@@@@@*            
                                                 :#%     %%%%%@@@@@@@@@@@@@@@@@=            
                                                  %%+ ##%%%%%@@@@@@@@@@@@@@@@@@.            
               =@@@@@@@@@@@@@@@@@@%%%%**         %%%%%%%%%%%@@@@@@@@@@@@@@@@@@@             
                @@@@@@@@@@@@@@@@@@@%%%%%%      %%%%%%%%%%%@@@@@@@@@@@@@@@@@@@@:             
                .@@@@@@@@@@@@@@@@@@@@%%%%%%%%%%%%%%%%%%%@@@@@@@@@@@@@@@@@@@@@*              
                 =@@@@@@@@@@@@@@@@@@@@@@%%%%%%%%%%%%@@@@@@@@@@@@@@@@@@@@@@@@@               
                  *@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@                
                   *@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@                 
                    :@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@                  
                     .@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@=                   
                       :@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@                     
                         +@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@                       
                           :@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@#                         
                              *@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@-                           
                                 .%@@@@@@@@@@@@@@@@@@@@@@@@@=                               
                                      -%@@@@@@@@@@@@@@@*.
`

    cmd := RootCmd()
    cmd.AddCommand(mockTodayCmd())

    outputBuffer := new(bytes.Buffer)
    cmd.SetOut(outputBuffer)
    cmd.SetArgs([]string{"--help"})

    err := cmd.Execute()

    output := outputBuffer.String()
    assert.NoError(t, err, "Executing --help should not return an error")
    assert.True(t, strings.Contains(output, expectedArt), "FAIL: Help output must contain the Anima ASCII art")
}
